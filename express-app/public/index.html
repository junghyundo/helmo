<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>Helmo ê¸°ë¡</title>
    <link rel="stylesheet" href="/css/index.css">
    <!-- Firebase SDK for Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- PDF ìƒì„±ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
    <div class="hamburger-menu" id="hamburgerMenu">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h3>ë©”ë‰´</h3>
        <button class="close-btn" id="closeSidebar">&times;</button>
      </div>
      <div class="sidebar-content">
        <div class="menu-item" id="pdfDownloadMenu">
          <div class="menu-icon">ğŸ“„</div>
          <div class="menu-text">PDF ë‹¤ìš´ë¡œë“œ</div>
        </div>
        <div class="menu-item" id="monthlyAnalysisMenu">
          <div class="menu-icon">ğŸ“Š</div>
          <div class="menu-text">ì›”ë³„ ë¶„ì„ ë³´ê¸°</div>
        </div>
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <header>
      <a href="/"><h1>Helmo ë¡œê³ </h1></a>
    </header>

    <div class="notice">
      <!-- ì•ˆë…•í•˜ì„¸ìš”! <strong>ë‚ ì§œë¥¼ í´ë¦­</strong>í•˜ì‹œë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. -->
      ğŸ˜Š ì•ˆë…•í•˜ì„¸ìš”! <strong>ë‚ ì§œë¥¼ í´ë¦­</strong>í•˜ì‹œë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>

    <section class="calendar">
      <div class="calendar-header">
        <button id="prevMonth">&lt;</button>
        <div id="monthYear">2025ë…„ 8ì›”</div>
        <button id="nextMonth">&gt;</button>
      </div>
      <div class="calendar-grid" id="calendarGrid">
        </div>
    </section>

    <section class="cards">
      <div class="card">
        <h3>ì¼ë³„ ê¸°ë¡</h3>
        <div class="date" id="daily-date"></div>
        <div class="content">ê²°ê³¼ ì—†ìŒ</div>
      </div>
      <div class="card">
        <h3>ì£¼ê°„ ê¸°ë¡</h3>
        <div class="date" id="weekly-date"></div>
        <div class="content">ë“±ê¸‰ / í‰ê·  ì°©ìš©ë¥ </div>
      </div>
      <div class="card">
        <h3>ì›”ê°„ ê¸°ë¡</h3>
        <div class="date" id="monthly-date"></div>
        <div class="content">ë“±ê¸‰ / ì›” í‰ê·  ì°©ìš©ë¥ </div>
      </div>
    </section>

    <script type="text/javascript" src="/js/firebase-config.js"></script>
    <script type="text/javascript" src="/js/test-data.js"></script>
    <script type="text/javascript" src="/js/callender.js"></script>
    
    <script>
      // ì‚¬ì´ë“œë°” ê´€ë ¨ í•¨ìˆ˜ë“¤
      function openSidebar() {
        document.getElementById('sidebar').classList.add('active');
        document.getElementById('sidebarOverlay').classList.add('active');
        document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë°©ì§€
      }

      function closeSidebar() {
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('sidebarOverlay').classList.remove('active');
        document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µì›
      }

      // ì›”ë³„ ë¶„ì„ ìƒì„¸ë³´ê¸° í•¨ìˆ˜
      function goToMonthlyResult() {
        // í˜„ì¬ ìº˜ë¦°ë”ì—ì„œ ì„ íƒëœ ì›” ì •ë³´ë¥¼ ê°€ì ¸ì˜´
        const monthYearText = document.getElementById('monthYear').textContent;
        const match = monthYearText.match(/(\d{4})ë…„\s*(\d{1,2})ì›”/);
        
        if (match) {
          const year = match[1];
          const month = match[2];
          
          // month_result.htmlë¡œ í˜„ì¬ ì—°ë„ì™€ ì›”ì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ ì´ë™
          window.location.href = `month_result.html?year=${year}&month=${month}`;
        } else {
          alert('ì›” ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      }

      // PDF ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
      function downloadPDF() {
        const monthYear = document.getElementById('monthYear').textContent;
        const monthlyCard = document.querySelector('.card:nth-child(3)');

        // html2canvasë¥¼ ì‚¬ìš©í•˜ì—¬ ì›”ê°„ ê¸°ë¡ ì¹´ë“œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
        html2canvas(monthlyCard).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF('p', 'mm', 'a4');
          const imgWidth = 210;
          const pageHeight = 295;
          const imgHeight = canvas.height * imgWidth / canvas.width;
          let heightLeft = imgHeight;
          let position = 0;

          // ì´ë¯¸ì§€ë¥¼ PDFì— ì¶”ê°€
          doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;

          // ì´ë¯¸ì§€ê°€ í˜ì´ì§€ë¥¼ ë„˜ì–´ê°ˆ ê²½ìš° ìƒˆ í˜ì´ì§€ ì¶”ê°€
          while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            doc.addPage();
            doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }

          // PDF íŒŒì¼ ë‹¤ìš´ë¡œë“œ
          doc.save(`Helmo_ì›”ê°„_ë³´ê³ ì„œ_${monthYear}.pdf`);
          
          // ì‚¬ì´ë“œë°” ë‹«ê¸°
          closeSidebar();
        }).catch(error => {
          console.error('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
          alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      }

      // í˜ì´ì§€ ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      document.addEventListener('DOMContentLoaded', function() {
        // í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('hamburgerMenu').addEventListener('click', openSidebar);
        
        // ì‚¬ì´ë“œë°” ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('closeSidebar').addEventListener('click', closeSidebar);
        
        // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ì‚¬ì´ë“œë°” ë‹«ê¸°
        document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
        
        // PDF ë‹¤ìš´ë¡œë“œ ë©”ë‰´ ì´ë²¤íŠ¸
        document.getElementById('pdfDownloadMenu').addEventListener('click', downloadPDF);
        
        // ì›”ë³„ ë¶„ì„ ë©”ë‰´ ì´ë²¤íŠ¸
        document.getElementById('monthlyAnalysisMenu').addEventListener('click', function() {
          closeSidebar();
          goToMonthlyResult();
        });

        // ESC í‚¤ë¡œ ì‚¬ì´ë“œë°” ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            closeSidebar();
          }
        });
      });
    </script>
  </body>
</html>